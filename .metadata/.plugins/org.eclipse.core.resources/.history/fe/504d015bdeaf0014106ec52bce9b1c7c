ui = require('UI');

weatherApi = function(lat, lon){
	var xhr = Ti.Network.createHTTPClient({
		onload: function(){
			var json = JSON.parse(this.responseText);
			var weatherData = {
				city: json.current_observation.display_location.city,
				temp: json.current_observation.temperture_string,
				time: json.current_observation.observation_time,
				cond: json.current_observation.observation_weather,
				wind: json.current_observation.wind_string,
				lat: json.current_observation.display_location.latitude,
				lon: json.current_observation.display_location.longitude,
				state: json.location.state,
				ing: json.current_observation.icon_url
			};
			ui.buildUI(weatherData);
			},
			onerror: function(){
				alert('Api Error');
			}
	
	});
	var url = 'http://api.wunderground.com/api/d8d6d376722c1591/geolookup/conditions/forcast/q/' +lat+ ',' +lon+ '.json';
	xhr.open('GET', url);
	xhr.send();
};


exports.weather = weatherApi;